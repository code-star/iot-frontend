{"version":3,"sources":["components/Map/Map.module.scss","components/Map/Map.tsx","components/App/fakerUtil.ts","components/App/App.tsx","reportWebVitals.ts","index.tsx"],"names":["module","exports","defaultViewport","latitude","longitude","zoom","bearing","pitch","Markers","sensorsData","useState","visibleSensorIndex","setVibleSensorIndex","toggleShowDetails","index","prevIndex","filter","sensorData","coordinates","map","lat","lng","className","styles","marker","onClick","details","JSON","stringify","Map","sensors","length","entry","getFirstSensorData","viewport","setViewport","width","height","mapStyle","onViewportChange","nextViewport","mapboxApiAccessToken","fakeData","find","line","n","v","addFakeData","a","counter","timer","setInterval","fetch","method","body","console","error","clearInterval","getData","response","json","temperature","App","setSensorsData","useEffect","fakeDataTimer","warn","init","interval","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.4336ee1b.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"marker\":\"Map_marker__1cD1H\",\"details\":\"Map_details__3JYjJ\"};","import React, { FC, useState } from 'react'\n\nimport ReactMapGL, { Marker } from 'react-map-gl'\nimport { Sensor } from '../../API/Sensor/Sensor'\nimport styles from './Map.module.scss'\n\nconst TOKEN = 'pk.eyJ1IjoiY29kZXN0YXItaW90IiwiYSI6ImNraDZjeTRjcTA5Z2Eyd281djNnc2d3eHUifQ.VcY4aGyFHBQo_r701-3A_A'\n\ntype MapProps = Readonly<{\n  sensorsData: Sensor[]\n}>\n\ntype MapViewport = Readonly<{\n  latitude: number\n  longitude: number\n  zoom: number\n  bearing: number\n  pitch: number\n}>\n\nconst defaultViewport: MapViewport = {\n  latitude: -1.9444,\n  longitude: 30.0616,\n  zoom: 15,\n  bearing: 0,\n  pitch: 0,\n}\n\nconst getFirstSensorData = (sensors: Sensor[]): MapViewport => {\n  if (!sensors.length) {\n    return defaultViewport\n  }\n\n  const {\n    coordinates: [lat, lng],\n  } = sensors.filter((entry) => {\n    return entry.coordinates[0] > 0\n  })[0]\n\n  return {\n    ...defaultViewport,\n    latitude: lat,\n    longitude: lng,\n  }\n}\n\nconst Markers: FC<MapProps> = ({ sensorsData }) => {\n  const [visibleSensorIndex, setVibleSensorIndex] = useState<number | null>(null)\n\n  const toggleShowDetails = (index: number) => () => {\n    setVibleSensorIndex((prevIndex) => (index === prevIndex ? null : index))\n  }\n\n  return (\n    <>\n      {sensorsData\n        .filter((sensorData) => sensorData.coordinates[0] > 0)\n        .map((sensorData, index) => {\n          const {\n            coordinates: [lat, lng],\n          } = sensorData\n\n          return (\n            <Marker key={index} className={styles.marker} longitude={lng} latitude={lat}>\n              <span onClick={toggleShowDetails(index)}>\n                <span>üìç</span>\n                {visibleSensorIndex === index ? (\n                  <div className={styles.details}>\n                    <pre>{JSON.stringify(sensorData, null, 2)}</pre>\n                  </div>\n                ) : null}\n              </span>\n            </Marker>\n          )\n        })}\n    </>\n  )\n}\n\nexport const Map: FC<MapProps> = ({ sensorsData }) => {\n  const [viewport, setViewport] = useState(getFirstSensorData(sensorsData))\n\n  return (\n    <div className=\"mapbox-react\">\n      <ReactMapGL\n        {...viewport}\n        width=\"100vw\"\n        height=\"100vh\"\n        mapStyle=\"mapbox://styles/mapbox/streets-v11\"\n        onViewportChange={(nextViewport) => setViewport(nextViewport)}\n        mapboxApiAccessToken={TOKEN}\n      >\n        <Markers sensorsData={sensorsData} />\n      </ReactMapGL>\n    </div>\n  )\n}\n","import { SensorJSON, SensorEntry } from '../../API/Sensor/Sensor';\nimport iotJson from '../../iot.json'\n\nconst fakeData: SensorJSON = iotJson.filter((entry: SensorEntry) => entry.find((line) => line.n === 'latitude')?.v);\n\nconst addFakeData = async (): Promise<NodeJS.Timeout> => {\n  let counter = 0\n  const timer = setInterval(async () => {\n    if (fakeData.length > counter) {\n      try {\n        await fetch('https://codestar-iot-api.herokuapp.com/set', {\n          method: 'POST',\n          body: JSON.stringify(fakeData[counter]),\n        })\n        counter++;\n      } catch (err) {\n        console.error(err)\n      }\n    } else {\n      clearInterval(timer)\n    }\n  }, 27000)\n  return timer\n}\n\nexport default addFakeData;\n","import React, { useEffect, useState } from 'react'\nimport { Map } from '../Map/Map'\nimport { Sensor, SensorEntry, SensorJSON } from '../../API/Sensor/Sensor'\nimport addFakeData from './fakerUtil'\n\nconst getData = async () => {\n  try {\n    const response = await fetch('https://codestar-iot-api.herokuapp.com/get')\n    const json: SensorJSON = await response.json()\n    // TODO it would be much better to use RxJS to do this\n    const sensorData: Sensor[] = json\n      .filter((entry: SensorEntry) => {\n        if(entry.find) {\n          const latitude = entry.find((line) => line.n === 'latitude')?.v ?? 0\n          const temperature = entry.find((line) => line.n === 'temperature')?.v ?? 0\n          return latitude || temperature  \n        }\n        return false;\n      })\n      .map((entry: SensorEntry) => {\n        const latitude = entry.find((line) => line.n === 'latitude')?.v ?? 0\n        const longitude = entry.find((line) => line.n === 'longitude')?.v ?? 0\n        const temperature = entry.find((line) => line.n === 'temperature')?.v ?? 0\n        return {\n          temperature,\n          coordinates: [latitude, longitude],\n        }\n      });\n      return sensorData\n  } catch (err) {\n    console.error(err)\n    return []\n  }\n}\n\nexport const App = () => {\n  const [sensorsData, setSensorsData] = useState<Sensor[]>()\n\n  useEffect(() => {\n    let fakeDataTimer: NodeJS.Timeout | null = null\n    const init = async () => {\n      const sensorData = await getData()\n      // const sensorData: Sensor[] = []\n      setSensorsData(sensorData)\n      if (sensorData.length === 0) {\n        console.warn(\"Initial sensorData was empty, so progressively injecting fake data\");\n        fakeDataTimer = await addFakeData()\n      }\n    }\n    init()\n    const interval = setInterval(async () => {\n      setSensorsData(await getData())\n    }, 10000)\n\n    return () => {\n      clearInterval(interval)\n      if (fakeDataTimer) {\n        clearInterval(fakeDataTimer)\n      }\n    }\n  }, [])\n\n  return (\n    <div>\n      {sensorsData ? (\n        <>\n          {/* <pre>{JSON.stringify(sensorsData, null, 2)}</pre> */}\n          <Map sensorsData={sensorsData} />\n        </>\n      ) : (\n        <p>No data</p>\n      )}\n    </div>\n  )\n}\n","import { ReportHandler } from 'web-vitals'\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport { App } from './components/App/App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}